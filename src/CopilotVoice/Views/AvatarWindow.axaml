<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="using:CopilotVoice.Views"
        x:Class="CopilotVoice.Views.AvatarWindow"
        Title="Copilot Voice"
        Width="280" SizeToContent="Height"
        CanResize="False"
        SystemDecorations="None"
        WindowStartupLocation="Manual"
        Background="Transparent"
        TransparencyLevelHint="Transparent"
        Topmost="True"
        ShowInTaskbar="False">

    <Border Background="#1E1E2E" CornerRadius="12" BorderBrush="#3B3B5C" BorderThickness="1"
            ClipToBounds="True">
        <Grid RowDefinitions="Auto,Auto,*,Auto,Auto,Auto">

            <!-- Header (replaces title bar) -->
            <Border Grid.Row="0" Padding="12,8" Background="#2D2D44"
                    CornerRadius="12,12,0,0">
                <Grid ColumnDefinitions="*,Auto,Auto,Auto">
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="ðŸ¤–" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="Copilot Voice" FontSize="13" FontWeight="Bold"
                                   Foreground="#CDD6F4" VerticalAlignment="Center"/>
                        <TextBlock x:Name="StatusBadge" Text="â— Starting..." FontSize="11"
                                   Foreground="#F9E2AF" VerticalAlignment="Center" Margin="8,0,0,0"/>
                    </StackPanel>
                    <!-- Mute toggle -->
                    <Button x:Name="MuteButton" Grid.Column="1" Content="ðŸ”Š"
                            FontSize="12" Padding="4,2" Margin="4,0"
                            Background="Transparent" Foreground="#A6ADC8"
                            BorderThickness="0" VerticalAlignment="Center"
                            ToolTip.Tip="Mute/unmute voice output"
                            Click="OnMuteClicked"/>
                    <!-- Pin (topmost) toggle -->
                    <Button x:Name="PinButton" Grid.Column="2" Content="ðŸ“Œ"
                            FontSize="12" Padding="4,2" Margin="4,0"
                            Background="Transparent" Foreground="#A6ADC8"
                            BorderThickness="0" VerticalAlignment="Center"
                            ToolTip.Tip="Toggle always on top"
                            Click="OnPinClicked"/>
                    <!-- Hide button -->
                    <Button x:Name="HideButton" Grid.Column="3" Content="â€”"
                            FontSize="12" Padding="4,2"
                            Background="Transparent" Foreground="#A6ADC8"
                            BorderThickness="0" VerticalAlignment="Center"
                            ToolTip.Tip="Hide (reopen from tray icon)"
                            Click="OnHideClicked"/>
                </Grid>
            </Border>

            <!-- Speech Balloon (above avatar) â€” Copilot's voice only -->
            <StackPanel Grid.Row="1" x:Name="BalloonPanel" Margin="14,8,14,0"
                        IsVisible="False">
                <Border Background="#45475A" CornerRadius="10" Padding="12,8">
                    <ScrollViewer MaxHeight="100" HorizontalScrollBarVisibility="Disabled"
                                  VerticalScrollBarVisibility="Auto">
                        <TextBlock x:Name="SpeechBubble" Text=""
                                   FontSize="12" Foreground="#CDD6F4" TextWrapping="Wrap"
                                   TextAlignment="Left"/>
                    </ScrollViewer>
                </Border>
                <!-- Triangle pointer pointing down to avatar -->
                <Canvas Height="10" HorizontalAlignment="Center" Width="20">
                    <Polygon Points="0,0 20,0 10,10" Fill="#45475A"/>
                </Canvas>
            </StackPanel>

            <!-- Pixel Art Avatar -->
            <Border Grid.Row="2" Padding="8" HorizontalAlignment="Center" VerticalAlignment="Center">
                <views:PixelAvatarControl x:Name="AvatarPixel"/>
            </Border>

            <!-- Transcription (user's voice) -->
            <Border Grid.Row="3" x:Name="TranscriptionPanel" Padding="8,4" Margin="10,0"
                    IsVisible="False">
                <TextBlock x:Name="TranscriptionText" Text=""
                           FontSize="10" Foreground="#A6ADC8" TextWrapping="Wrap"
                           MaxHeight="32" HorizontalAlignment="Center" FontStyle="Italic"/>
            </Border>

            <!-- Session info -->
            <Border Grid.Row="4" Padding="10,4" Margin="10,0">
                <TextBlock x:Name="SessionLabel" Text="ðŸ“‚ waiting..."
                           FontSize="10" Foreground="#6C7086" HorizontalAlignment="Center"/>
            </Border>

            <!-- Status Bar -->
            <Border Grid.Row="5" Padding="10,6" Background="#2D2D44"
                    CornerRadius="0,0,12,12">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- Record button (red circle) -->
                    <Border x:Name="RecordButton" Grid.Column="0"
                            Width="28" Height="28" CornerRadius="14"
                            Background="#3B3B5C" Margin="0,0,8,0"
                            VerticalAlignment="Center" Cursor="Hand"
                            ToolTip.Tip="Hold to talk">
                        <Ellipse x:Name="RecordDot" Width="14" Height="14"
                                 Fill="#F38BA8" HorizontalAlignment="Center"
                                 VerticalAlignment="Center" Opacity="0.6"/>
                    </Border>
                    <TextBlock x:Name="HotkeyLabel" Grid.Column="1" Text="âŒ¨ï¸ Ctrl+Space"
                               FontSize="10" Foreground="#6C7086" VerticalAlignment="Center"/>
                    <TextBlock x:Name="TimerLabel" Grid.Column="2" Text=""
                               FontSize="10" Foreground="#F9E2AF" VerticalAlignment="Center"/>
                </Grid>
            </Border>

        </Grid>
    </Border>
</Window>
